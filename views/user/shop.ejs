<!doctype html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Watch shop | eCommers</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="site.webmanifest">
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.ico">

    <!-- CSS here -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="assets/css/flaticon.css">
    <link rel="stylesheet" href="assets/css/slicknav.css">
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <link rel="stylesheet" href="assets/css/magnific-popup.css">
    <link rel="stylesheet" href="assets/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/css/themify-icons.css">
    <link rel="stylesheet" href="assets/css/slick.css">
    <link rel="stylesheet" href="assets/css/nice-select.css">
    <link rel="stylesheet" href="assets/css/style.css">



    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

    <style>
        .rating {
            color: #ffc107;
            margin: 10px 0;
        }

        .rating-count {
            color: #6c757d;
            font-size: 0.9em;
            margin-left: 5px;
        }

        .product-meta {
            font-size: 0.9em;
            color: #6c757d;
        }

        .brand,
        .category {
            margin: 0 5px;
        }

        .tags {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tag {
            background: #f8f9fa;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            color: #6c757d;
        }

        .description {
            color: #6c757d;
            font-size: 0.9em;
            line-height: 1.5;
            margin: 10px 0;
        }

        .original-price {
            text-decoration: line-through;
            color: #999;
            margin-left: 10px;
            font-size: 0.9em;
        }

        .view-details-btn {
            display: inline-block;
            padding: 8px 20px;
            background-color: #000;
            color: #fff;
            text-decoration: none;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .view-details-btn:hover {
            background-color: #333;
            color: #fff;
            transform: translateY(-2px);
        }
        .popular-img {
            position: relative;
            width: 300px;
            /* Fixed width container */
            height: 300px;
            /* Fixed height container */
            margin: 0 auto;
            overflow: hidden;
            background-color: #f8f9fa;
        }

        .popular-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            transition: transform 0.3s ease;
        }

        .popular-img:hover img {
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .popular-img {
                width: 250px;
                height: 250px;
            }
        }

        @media (max-width: 480px) {
            .popular-img {
                width: 200px;
                height: 200px;
            }
        }

        .single-popular-items {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .popular-caption {
            width: 100%;
            padding: 20px;
            margin-top: 15px;
        }

        .filter-section {
            background-color: #f8f9fa;
        }

        .filter-panel {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            z-index: 1000;
            padding: 20px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .filter-row {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .filter-row:last-child {
            border-bottom: none;
        }

        .btn-group {
            flex-wrap: wrap;
            gap: 5px;
        }

        .btn-outline-dark {
            border-radius: 20px;
            padding: 5px 15px;
            font-size: 0.9rem;
        }

        .btn-check:checked+.btn-outline-dark {
            background-color: #212529;
            color: white;
        }

        .active-filters .badge {
            background-color: #212529;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin: 2px;
        }

        .active-filters .badge button {
            background: none;
            border: none;
            color: white;
            padding: 0;
            font-size: 14px;
            cursor: pointer;
        }

        .form-select:focus,
        .form-control:focus {
            border-color: #212529;
            box-shadow: 0 0 0 0.25rem rgba(33, 37, 41, 0.25);
        }

        .filter-panel {
            transition: all 0.3s ease-in-out;
        }

        @media (max-width: 768px) {
            .btn-group {
                flex-direction: column;
                width: 100%;
            }

            .btn-outline-dark {
                width: 100%;
                margin: 2px 0;
            }

            .filter-row .row {
                margin-bottom: 10px;
            }
        }

        .product-card {
            transition: transform 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-img-container {
            overflow: hidden;
        }

        .product-overlay {
            background: rgba(255, 255, 255, 0.9);
            transition: opacity 0.3s ease;
        }

        .product-card:hover .product-overlay {
            opacity: 1 !important;
        }

        .product-title {
            font-size: 1rem;
            line-height: 1.4;
            height: 2.8em;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .filter-section {
            background-color: #f8f9fa;
        }

        .filter-sidebar {
            background-color: #ffffff;
            border: 1px solid #dee2e6;
        }

        .filter-group {
            border-bottom: 1px solid #eee;
            padding-bottom: 1.5rem;
        }

        .filter-group:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .form-check-input:checked {
            background-color: #212529;
            border-color: #212529;
        }

        .active-filters .badge {
            background-color: #212529;
            color: #fff;
            font-weight: normal;
            padding: 0.5rem 0.75rem;
            margin: 0.25rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .active-filters .badge button {
            background: none;
            border: none;
            color: #fff;
            padding: 0;
            font-size: 0.875rem;
        }

        @media (max-width: 991.98px) {
            .filter-sidebar {
                margin-bottom: 2rem;
            }
        }

        .filter-sidebar {
            transition: all 0.3s ease;
        }

        .form-select:focus,
        .form-control:focus {
            border-color: #212529;
            box-shadow: 0 0 0 0.25rem rgba(33, 37, 41, 0.25);
        }

        .btn-dark:hover {
            background-color: #343a40;
            transform: translateY(-1px);
            transition: all 0.3s ease;
        }
        .product-card {
            transition: transform 0.3s ease;
            margin-bottom: 30px;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-img-container {
            overflow: hidden;
        }

        .product-overlay {
            background: rgba(255, 255, 255, 0.9);
            transition: opacity 0.3s ease;
        }

        .product-card:hover .product-overlay {
            opacity: 1 !important;
        }

        .product-title {
            font-size: 1rem;
            line-height: 1.4;
            height: 2.8em;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        @media (max-width: 991.98px) {
            .col-md-6 {
                max-width: 50%;
            }
        }

        @media (max-width: 767.98px) {
            .col-12 {
                max-width: 100%;
            }

            .product-img-container {
                height: 250px;
            }
        }

        .row {
            display: flex;
            flex-wrap: wrap;
        }

        .col-lg-4 {
            padding: 0 15px;
        }

        .row>div:nth-last-child(-n+3) .product-card {
            margin-bottom: 0;
        }

        .popular-product-name {
            margin: 15px 0;
            min-height: 48px;
        }

        .popular-product-name a {
            color: #444444;
            font-weight: 500;
            font-size: 18px;
            text-decoration: none;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.3;
            transition: color 0.3s ease;
        }

        .popular-product-name a:hover {
            color: #000000;
        }

        .popular-caption {
            padding: 20px;
            text-align: center;
        }

        .price {
            font-size: 18px;
            font-weight: 500;
            color: #444444;
        }

        .original-price {
            text-decoration: line-through;
            color: #777;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .popular-product-name a {
                font-size: 16px;
            }

            .price {
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .popular-product-name {
                min-height: 40px;
            }

            .popular-product-name a {
                font-size: 15px;
            }
        }
    </style>
</head>

<body>
    <!-- Header Start -->
    <header>
        <div class="header-area">
            <div class="main-header header-sticky">
                <div class="container-fluid">
                    <div class="menu-wrapper">
                        <!-- Logo -->
                        <div class="logo">
                            <a href="index.html"><img src="assets/img/logo/logo.png" alt=""></a>
                        </div>
                        <!-- Main-menu -->
                        <div class="main-menu d-none d-lg-block">
                            <nav>
                                <ul id="navigation">
                                    <li><a href="/">Home</a></li>
                                    <li><a href="/shop">shop</a></li>
                                    <li><a href="about.html">about</a></li>
                                    <li><a href="contact.html">Contact</a></li>
                                </ul>
                            </nav>
                        </div>
                        <!-- Header Right -->
                        <div class="header-right">
                            <ul>
                                <li>
                                    <div class="nav-search search-switch">
                                        <span class="flaticon-search"></span>
                                    </div>
                                </li>
                                <li><a href="/update-profile"><span class="flaticon-user"></span></a></li>
                                <li><a href="/cart"><span class="flaticon-shopping-cart"></span></a></li>
                            </ul>
                        </div>
                    </div>
                    <!-- Mobile Menu -->
                    <div class="col-12">
                        <div class="mobile_menu d-block d-lg-none"></div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Header End -->

    <main>
        <!-- Hero Area Start-->
        <div class="slider-area">
            <div class="single-slider slider-height2 d-flex align-items-center">
                <div class="container">
                    <div class="row">
                        <div class="col-xl-12">
                            <div class="hero-cap text-center">
                                <h2>Watch Shop</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Hero Area End-->
        <section class="filter-section py-4 position-relative">
            <div class="container">
                <!-- Top Bar with Filter Button and Search -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <button class="btn btn-dark d-flex align-items-center" id="filterToggle" style="padding: 5px 10px; font-size: 0.85rem;">
                            <i class="fas fa-filter me-2"></i>
                            Filters
                        </button>
                    </div>
                    <div class="col-md-6">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Search products..." id="searchInput" style="padding: 5px; font-size: 0.85rem;">
                            <button class="btn btn-dark " id="searchBtn" style="padding: 5px 10px; font-size: 0.85rem;">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Filter Panel -->
                <div class="filter-panel shadow" id="filterPanel" style="display: none;">
                    <!-- Price Range Filter Row -->
                    <div class="filter-row">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <h5 class="mb-0">Price Range</h5>
                            </div>
                            <div class="col-md-9">
                                <div class="price-range-options">
                                    <div class="btn-group" role="group">
                                        <input type="radio" class="btn-check" name="priceRange" id="price1"
                                            value="₹0.00 - ₹999.00">
                                        <label  for="price1">₹0 - ₹999</label>

                                        <input type="radio" class="btn-check" name="priceRange" id="price2"
                                            value="₹1000.00 - ₹2999.00">
                                        <label for="price2">₹1,000 - ₹2,999</label>

                                        <input type="radio" class="btn-check" name="priceRange" id="price3"
                                            value="₹3000.00 - ₹6999.00">
                                        <label  for="price3">₹3,000 - ₹6,999</label>

                                        <input type="radio" class="btn-check" name="priceRange" id="price4"
                                            value="₹7000.00 - ₹9999.00">
                                        <label  for="price4">₹7,000 - ₹9,999</label>

                                        <input type="radio" class="btn-check" name="priceRange" id="price5"
                                            value="₹10000.00+">
                                        <label  for="price5">₹10,000+</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sort By Filter Row -->
                    <div class="filter-row">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <h5 class="mb-0">Sort By</h5>
                            </div>
                            <div class="col-md-9">
                                <select class="form-select" id="sortBy">
                                    <option value="">Select Option</option>
                                    <option value="Price: Low to High">Price: Low to High</option>
                                    <option value="Price: High to Low">Price: High to Low</option>
                                    <option value="aA - zZ">Name: A to Z</option>
                                    <option value="zZ - aA">Name: Z to A</option>
                                    <option value="Newness">Newest First</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="filter-row">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <h5 class="mb-0">Category</h5>
                            </div>
                            <div class="col-md-9">
                                <select class="form-select" id="category">
                                    <option value="*">All Categories</option>
                                    <% categories.forEach(category => { %>
                                        <option value="<%= category.name %>"><%= category.name %></option>
                                    <% }) %>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Availability Filter Row -->
                    <div class="filter-row">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <h5 class="mb-0">Availability</h5>
                            </div>
                            <div class="col-md-9">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="excludeOutOfStock">
                                    <label class="form-check-label" for="excludeOutOfStock">
                                        Show only in-stock items
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filter Actions -->
                    <div class="filter-actions mt-3">
                        <div class="row">
                            <div class="col-md-12 text-end">
                                <button class="btn btn-dark me-2" id="clearFilters" style="padding: 15px 10px;font-size: 0.85rem;">Clear All</button>
                                <button class="btn btn-dark" id="applyFilters" style="padding: 15px 10px;font-size: 0.85rem;">Apply Filters</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Active Filters Display -->
                <div class="active-filters mt-3" style="display: none;">
                    <div class="d-flex flex-wrap gap-2 align-items-center">
                        <span class="fw-bold me-2">Active Filters:</span>
                        <!-- Active filters will be added here dynamically -->
                    </div>
                </div>
            </div>
        </section>


        <!-- Product Grid Section -->
        <section class="product-grid py-5">
            <div class="container">
                <div class="row">
                    <% if (products.length===0 || products.every(product=> product.isDeleted)) { %>
                        <div class="col-12 text-center">
                            <p>No products available at the moment.</p>
                        </div>
                        <% } else { %>
                            <% products.filter(product=> !product.isDeleted).forEach((product, index) => { %>
                                <!-- Each product takes up exactly 1/3 of the row -->
                                <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6">
                                    <div class="single-popular-items mb-50 text-center">
                                        <div class="popular-img">
                                            <img src="<%= product.images[0] || '/assets/img/default-product.png' %>"
                                                alt="<%= product.name %>">
                                            <div class="img-cap">
                                                <span>Add to cart</span>
                                            </div>
                                            <div class="favorit-items">
                                                <span class="flaticon-heart"></span>
                                            </div>
                                        </div>
                                        <div class="popular-caption">
                                            <h3 class="popular-product-name">
                                                <a href="/product/<%= product._id %>">
                                                    <%= product.name %>
                                                </a>
                                            </h3>

                                            <!-- Price Display -->
                                            <div class="pricing">
                                                <% if (product.offerPrice && product.offerPrice < product.price) { %>
                                                    <span class="price">₹<%= product.offerPrice.toFixed(2) %></span>
                                                    <span class="original-price">₹<%= product.price.toFixed(2) %></span>
                                                    <% } else { %>
                                                        <span class="price">₹<%= product.price.toFixed(2) %></span>
                                                        <% } %>
                                            </div>

                                            <!-- Rating Display -->
                                            <div class="rating mt-2">
                                                <% for(let i=1; i <=5; i++) { %>
                                                    <% if (i <=Math.round(product.rating)) { %>
                                                        <i class="fas fa-star"></i>
                                                        <% } else { %>
                                                            <i class="far fa-star"></i>
                                                            <% } %>
                                                                <% } %>
                                                                    <span class="rating-count">
                                                                        (<%= product.reviews.length %> reviews)
                                                                    </span>
                                            </div>

                                            <!-- Brand & Category -->
                                            <% if (product.brand || (product.category && product.category.name)) { %>
                                                <div class="product-meta mt-2">
                                                    <% if (product.brand) { %>
                                                        <span class="brand">
                                                            <%= product.brand %>
                                                        </span>
                                                        <% } %>
                                                            <% if (product.category && product.category.name) { %>
                                                                <span class="category">| <%= product.category.name %>
                                                                        </span>
                                                                <% } %>
                                                </div>
                                                <% } %>

                                                    <!-- Tags -->
                                                    <% if (product.tags && product.tags.length> 0) { %>
                                                        <div class="tags mt-2">
                                                            <% product.tags.slice(0, 3).forEach(tag=> { %>
                                                                <span class="tag">
                                                                    <%= tag %>
                                                                </span>
                                                                <% }) %>
                                                        </div>
                                                        <% } %>

                                                            <a href="/product/<%= product._id %>"
                                                                class="view-details-btn mt-3">View Details</a>
                                        </div>
                                    </div>
                                </div>

                                <!-- Add clearfix after every 3rd item to force new row -->
                                <% if ((index + 1) % 3===0) { %>
                                    <div class="clearfix d-none d-lg-block"></div>
                                    <% } %>
                                        <% }) %>
                                            <% } %>
                </div>
            </div>
        </section>

    </main>

    <footer>
        <!-- Footer Start-->
        <div class="footer-area footer-padding">
            <div class="container">
                <div class="row d-flex justify-content-between">
                    <div class="col-xl-3 col-lg-3 col-md-5 col-sm-6">
                        <div class="single-footer-caption mb-50">
                            <div class="single-footer-caption mb-30">
                                <!-- Footer Logo -->
                                <div class="footer-logo">
                                    <a href="index.html"><img src="assets/img/logo/logo2_footer.png" alt=""></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer End-->
    </footer>

    <!-- JS here -->
    <script src="./assets/js/vendor/modernizr-3.5.0.min.js"></script>
    <script src="./assets/js/vendor/jquery-1.12.4.min.js"></script>
    <script src="./assets/js/popper.min.js"></script>
    <script src="./assets/js/bootstrap.min.js"></script>
    <script src="./assets/js/jquery.slicknav.min.js"></script>
    <script src="./assets/js/owl.carousel.min.js"></script>
    <script src="./assets/js/slick.min.js"></script>
    <script src="./assets/js/wow.min.js"></script>
    <script src="./assets/js/animated.headline.js"></script>
    <script src="./assets/js/jquery.magnific-popup.js"></script>
    <script src="./assets/js/jquery.nice-select.min.js"></script>
    <script src="./assets/js/jquery.sticky.js"></script>
    <script src="./assets/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Close buttons for active filters
            document.querySelectorAll('.active-filters .btn-close').forEach(button => {
                button.addEventListener('click', function () {
                    this.closest('.badge').remove();
                });
            });

            // Sort option selection
            // document.querySelectorAll('input[name="sortOption"]').forEach(radio => {
            //     radio.addEventListener('change', function () {
            //         console.log('Sort option selected:', this.id);
            //         // Add your sorting logic here
            //     });
            // });

            // // Price range inputs
            // const minPrice = document.querySelector('input[placeholder="Min"]');
            // const maxPrice = document.querySelector('input[placeholder="Max"]');

            // [minPrice, maxPrice].forEach(input => {
            //     input.addEventListener('change', function () {
            //         console.log('Price range updated:', {
            //             min: minPrice.value,
            //             max: maxPrice.value
            //         });
            //         // Add your price filter logic here
            //     });
            // });
        });
    </script>































<script>
    function updateProductList(products) {
        const productGrid = document.querySelector('.product-grid .row');
        
        productGrid.innerHTML = '';
    
        if (products.length === 0) {
            productGrid.innerHTML = `
                <div class="col-12 text-center">
                    <p>No products available matching your filters.</p>
                </div>`;
            return;
        }
    
        products.filter(product => !product.isDeleted).forEach((product, index) => {
            const productHTML = `
                <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6">
                    <div class="single-popular-items mb-50 text-center">
                        <div class="popular-img">
                            <img src="${product.images[0] || '/assets/img/default-product.png'}" 
                                 alt="${product.name}">
                            <div class="img-cap">
                                <span>Add to cart</span>
                            </div>
                            <div class="favorit-items">
                                <span class="flaticon-heart"></span>
                            </div>
                        </div>
                        <div class="popular-caption">
                            <h3 class="popular-product-name">
                                <a href="/product/${product._id}">${product.name}</a>
                            </h3>
                            
                            <div class="pricing">
                                ${product.offerPrice && product.offerPrice < product.price 
                                    ? `<span class="price">₹${product.offerPrice.toFixed(2)}</span>
                                       <span class="original-price">₹${product.price.toFixed(2)}</span>`
                                    : `<span class="price">₹${product.price.toFixed(2)}</span>`
                                }
                            </div>
    
                            <div class="rating mt-2">
                                ${generateRatingStars(product.rating)}
                                <span class="rating-count">(${product.reviews.length} reviews)</span>
                            </div>
    
                            ${(product.brand || (product.category && product.category.name)) 
                                ? `<div class="product-meta mt-2">
                                     ${product.brand ? `<span class="brand">${product.brand}</span>` : ''}
                                     ${product.category && product.category.name 
                                         ? `<span class="category">| ${product.category.name}</span>` 
                                         : ''}
                                   </div>`
                                : ''
                            }
    
                            ${product.tags && product.tags.length > 0 
                                ? `<div class="tags mt-2">
                                     ${product.tags.slice(0, 3).map(tag => 
                                         `<span class="tag">${tag}</span>`
                                     ).join('')}
                                   </div>`
                                : ''
                            }
    
                            <a href="/product/${product._id}" class="view-details-btn mt-3">View Details</a>
                        </div>
                    </div>
                </div>
                ${(index + 1) % 3 === 0 ? '<div class="clearfix d-none d-lg-block"></div>' : ''}
            `;
            
            productGrid.insertAdjacentHTML('beforeend', productHTML);
        });
    }
    
    // Helper function to generate rating stars
    function generateRatingStars(rating) {
        let starsHtml = '';
        const roundedRating = Math.round(rating);
        
        for (let i = 1; i <= 5; i++) {
            if (i <= roundedRating) {
                starsHtml += '<i class="fas fa-star"></i>';
            } else {
                starsHtml += '<i class="far fa-star"></i>';
            }
        }
        
        return starsHtml;
    }
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const filterToggle = document.getElementById('filterToggle');
    const filterPanel = document.getElementById('filterPanel');
    const applyFiltersBtn = document.getElementById('applyFilters');
    const clearFiltersBtn = document.getElementById('clearFilters');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const activeFilters = document.querySelector('.active-filters');
    
    let searchTimeout;

    filterToggle.addEventListener('click', function () {
        const isVisible = filterPanel.style.display === 'block';
        filterPanel.style.display = isVisible ? 'none' : 'block';
        filterToggle.classList.toggle('active');
    });

    async function performSearch() {
        const searchTerm = searchInput.value.trim();
        const excludeOutOfStock = document.getElementById('excludeOutOfStock').checked;

        if (searchTerm === '') {
            applyFiltersBtn.click();
            return;
        }

        try {

            const response = await fetch('/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    search: searchTerm,
                    excludeOutOfStock: excludeOutOfStock
                })
            });

            const data = await response.json();
            if (data.products) {
                updateProductList(data.products);
                updateActiveFilters({
                    searchTerm: `Search: ${searchTerm}`
                });
                activeFilters.style.display = 'block';
            }
        } catch (error) {
            console.error('Search error:', error);
        }
    }

    async function applyFilters() {
        const filters = {
            sortBy: document.getElementById('sortBy').value,
            priceRange: Array.from(document.querySelectorAll('input[name="priceRange"]'))
                .find(input => input.checked)?.value,
            category: document.getElementById('category').value,
            excludeOutOfStock: document.getElementById('excludeOutOfStock').checked
        };
        
        

        try {
            const response = await fetch('/filter', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(filters)
            });

            const data = await response.json();
            if (data.products) {
                updateProductList(data.products);
                updateActiveFilters(filters);
                filterPanel.style.display = 'none';
                activeFilters.style.display = Object.values(filters).some(value => value) ? 'block' : 'none';
            }
        } catch (error) {
            console.error('Filter error:', error);
        }
    }

    function updateActiveFilters(filters) {
        const activeFiltersContainer = document.querySelector('.active-filters > div');
        activeFiltersContainer.innerHTML = '<span class="fw-bold me-2">Active Filters:</span>';

        Object.entries(filters).forEach(([key, value]) => {
            if (value && value !== '*' && value !== '') {
                const badge = document.createElement('span');
                badge.className = 'badge';
                badge.innerHTML = `
                    ${key === 'searchTerm' ? value : `${key}: ${value}`}
                    <button onclick="removeFilter('${key}')">&times;</button>
                `;
                activeFiltersContainer.appendChild(badge);
            }
        });
    }

    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(performSearch, 500); 
    });

    searchBtn.addEventListener('click', performSearch);

    applyFiltersBtn.addEventListener('click', applyFilters);

    clearFiltersBtn.addEventListener('click', function() {

        document.getElementById('sortBy').value = '';
        document.querySelectorAll('input[name="priceRange"]')
            .forEach(input => input.checked = false);
        document.getElementById('category').value = '*';
        document.getElementById('excludeOutOfStock').checked = false;
        searchInput.value = '';

        applyFilters();
        

        activeFilters.style.display = 'none';
        document.querySelector('.active-filters > div').innerHTML = 
            '<span class="fw-bold me-2">Active Filters:</span>';
    });

    window.removeFilter = function(filterKey) {
        switch (filterKey) {
            case 'sortBy':
                document.getElementById('sortBy').value = '';
                break;
            case 'priceRange':
                document.querySelectorAll('input[name="priceRange"]')
                    .forEach(input => input.checked = false);
                break;
            case 'category':
                document.getElementById('category').value = '*';
                break;
            case 'excludeOutOfStock':
                document.getElementById('excludeOutOfStock').checked = false;
                break;
            case 'searchTerm':
                searchInput.value = '';
                break;
        }

        if (filterKey === 'searchTerm') {
            applyFilters();
        } else {
            const currentSearchTerm = searchInput.value.trim();
            if (currentSearchTerm) {
                performSearch();
            } else {
                applyFilters();
            }
        }
    };

    document.addEventListener('click', function(event) {
        if (!filterPanel.contains(event.target) && 
            !filterToggle.contains(event.target) && 
            filterPanel.style.display === 'block') {
            filterPanel.style.display = 'none';
        }
    });
});
</script>

</body>

</html>